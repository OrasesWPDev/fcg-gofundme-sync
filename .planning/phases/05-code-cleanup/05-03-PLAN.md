---
phase: 05-code-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - CLAUDE.md
  - fcg-gofundme-sync.php
  - readme.txt
autonomous: true

must_haves:
  truths:
    - "CLAUDE.md accurately reflects new single master campaign architecture"
    - "Plugin version bumped to indicate architecture change"
    - "Plugin activates without errors after all changes"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Updated project documentation"
      contains: "single master campaign"
    - path: "fcg-gofundme-sync.php"
      provides: "Main plugin file with bumped version"
      contains: "Version: 2.3.0"
  key_links:
    - from: "fcg-gofundme-sync.php"
      to: "includes/class-sync-handler.php"
      via: "require_once"
      pattern: "require_once.*class-sync-handler"
---

<objective>
Update documentation and bump plugin version

Purpose: Document the architecture pivot and signal the change via version bump
Output: Updated CLAUDE.md and plugin version 2.3.0
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-code-cleanup/05-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CLAUDE.md to reflect new architecture</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md to reflect the single master campaign architecture:

**Update "Sync Behavior" section:**

Replace the current table with:

```markdown
## Sync Behavior

| WordPress Action | API Action |
|-----------------|------------|
| Publish fund | Create designation, link to master campaign |
| Update fund | Update designation |
| Unpublish/Draft | Set designation `is_active = false` |
| Trash | Set designation `is_active = false` |
| Restore from trash | Set designation `is_active = true` |
| Permanent delete | Delete designation |

**Note:** Campaign duplication was removed in v2.3.0. Designations are now linked to a single master campaign configured in plugin settings.
```

**Update "Post Meta Keys" section:**

Replace with:

```markdown
## Post Meta Keys

**Active (designation sync):**
- `_gofundme_designation_id`: Classy designation ID
- `_gofundme_last_sync`: Timestamp of last successful sync

**Inbound sync (donation totals):**
- `_gofundme_donation_total`: Total donations for fund
- `_gofundme_donor_count`: Number of donors
- `_gofundme_goal_progress`: Percentage of goal reached
- `_gofundme_last_inbound_sync`: Timestamp of last inbound sync

**Legacy (orphaned after v2.3.0):**
- `_gofundme_campaign_id`: Per-fund campaign ID (no longer used)
- `_gofundme_campaign_url`: Per-fund campaign URL (no longer used)
- `_gofundme_campaign_status`: Per-fund campaign status (no longer used)

Legacy meta can be cleaned up with WP-CLI if needed.
```

**Add "Architecture" section after "Configuration":**

```markdown
## Architecture (v2.3.0+)

**Single Master Campaign Model:**
- One master campaign in Classy contains all designations
- Each WordPress fund maps to one Classy designation
- Designations are linked to the master campaign via `PUT /campaigns/{id}` with `{"designation_id": "{id}"}`
- Frontend embeds use `?designation={id}` parameter to pre-select the correct fund

**Plugin flow:**
1. Fund published in WordPress
2. Plugin creates designation via Classy API
3. Plugin links designation to master campaign (Phase 6)
4. Frontend embed uses `?designation={id}` to show correct fund

**Removed in v2.3.0:**
- Per-fund campaign duplication
- Campaign publish/unpublish/deactivate/reactivate workflow
- Campaign status synchronization
```

**Keep all other sections unchanged:**
- Project Overview
- Configuration
- Requirements
- Debugging
- SSH Access sections
- Deployment sections
- Security Guidelines
- Development Workflow
  </action>
  <verify>
Run: `grep -n "single master campaign\|v2.3.0" CLAUDE.md`
Expect: Multiple matches (new content present)

Run: `grep -n "duplicate_campaign\|publish_campaign" CLAUDE.md`
Expect: No matches (old campaign workflow removed from docs)
  </verify>
  <done>
- "Sync Behavior" section updated for designation-only sync
- "Post Meta Keys" section updated with active/legacy distinction
- New "Architecture" section added explaining single master campaign model
- All operational sections (SSH, Deployment, etc.) unchanged
  </done>
</task>

<task type="auto">
  <name>Task 2: Bump plugin version to 2.3.0</name>
  <files>fcg-gofundme-sync.php</files>
  <action>
Update plugin version to mark the architecture pivot:

**Line 9:** Change:
```php
 * Version: 2.2.0
```
to:
```php
 * Version: 2.3.0
```

**Line 24:** Change:
```php
define('FCG_GFM_SYNC_VERSION', '2.2.0');
```
to:
```php
define('FCG_GFM_SYNC_VERSION', '2.3.0');
```

**Rationale for 2.3.0 (minor version bump):**
- Major architectural change (removal of campaign duplication)
- Not breaking existing designations
- New installs will work with single master campaign approach
- Existing sites continue to work (legacy campaign meta is ignored)
  </action>
  <verify>
Run: `php -l fcg-gofundme-sync.php`
Expect: No syntax errors

Run: `grep -n "2.3.0" fcg-gofundme-sync.php`
Expect: 2 matches (header and constant)

Run: `grep -n "2.2.0" fcg-gofundme-sync.php`
Expect: No matches (old version replaced)
  </verify>
  <done>
- Plugin header version updated to 2.3.0
- FCG_GFM_SYNC_VERSION constant updated to 2.3.0
- File passes PHP syntax check
  </done>
</task>

<task type="auto">
  <name>Task 3: Update readme.txt version</name>
  <files>readme.txt</files>
  <action>
Update readme.txt to reflect the new version and document the change:

**Update "Stable tag" in header:**
```
Stable tag: 2.3.0
```

**Add changelog entry at top of Changelog section:**
```
= 2.3.0 =
* Architecture: Removed per-fund campaign duplication in favor of single master campaign
* Removed: Campaign publish/unpublish/deactivate/reactivate workflow
* Removed: Per-fund campaign sync (META_CAMPAIGN_ID, META_CAMPAIGN_URL)
* Simplified: Sync handler now focuses exclusively on designation sync
* Note: Legacy campaign meta remains in database but is no longer used
```
  </action>
  <verify>
Run: `grep -n "2.3.0" readme.txt`
Expect: Matches in stable tag and changelog

Run: `grep -n "Stable tag:" readme.txt | head -1`
Expect: Contains "2.3.0"
  </verify>
  <done>
- readme.txt stable tag updated to 2.3.0
- Changelog entry added documenting architecture change
  </done>
</task>

</tasks>

<verification>
1. CLAUDE.md documents single master campaign architecture
2. Plugin version is 2.3.0 in both header and constant
3. readme.txt version matches and includes changelog
4. All files pass syntax checks where applicable
</verification>

<success_criteria>
- CLAUDE.md accurately describes post-pivot architecture
- No references to campaign duplication workflow in documentation
- Plugin version 2.3.0 signals the architecture change
- readme.txt changelog documents what changed
</success_criteria>

<output>
After completion, create `.planning/phases/05-code-cleanup/05-03-SUMMARY.md`
</output>
