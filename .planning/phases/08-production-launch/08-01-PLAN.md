---
phase: 08-production-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/class-admin-ui.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Admin sees donation total in fund edit meta box"
    - "Admin sees donor count in fund edit meta box"
    - "Admin sees last inbound sync timestamp in meta box"
  artifacts:
    - path: "includes/class-admin-ui.php"
      provides: "Donation totals display in meta box"
      contains: "_gofundme_donation_total"
  key_links:
    - from: "includes/class-admin-ui.php"
      to: "post_meta"
      via: "get_post_meta() calls for inbound sync data"
      pattern: "get_post_meta.*_gofundme_donation_total"
---

<objective>
Add donation totals display to admin meta box (ADMN-02)

Purpose: Complete admin UI visibility by showing inbound sync data (donation totals, donor count, goal progress) from Phase 4's sync poller in the fund edit screen meta box.

Output: Updated class-admin-ui.php with donation totals section in meta box.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-production-launch/08-RESEARCH.md

# Source files
@includes/class-admin-ui.php
@includes/class-sync-poller.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add donation totals display to meta box</name>
  <files>includes/class-admin-ui.php</files>
  <action>
In `render_sync_meta_box()` method (after the "Last Source" paragraph around line 164), add a section displaying inbound sync data:

1. Get the inbound sync post meta values:
   - `_gofundme_donation_total` (float)
   - `_gofundme_donor_count` (int)
   - `_gofundme_goal_progress` (float percentage)
   - `_gofundme_last_inbound_sync` (timestamp string)

2. Display these values with appropriate formatting:
   - Add an `<hr>` separator before the section
   - Donation Total: Format as currency with 2 decimal places (e.g., $1,234.56)
   - Donor Count: Format as integer
   - Goal Progress: Show percentage only if both fundraising_goal and goal_progress exist
   - Last Inbound Sync: Show timestamp or "Never" if empty

3. Follow existing meta box styling patterns (use `<p>` with `<strong>` labels, `<em>` for empty states)

4. Only show the section if donation_total or donor_count has a value (don't show empty section for funds that haven't received donations)

Reference the code example in 08-RESEARCH.md for exact implementation pattern.
  </action>
  <verify>
1. `grep -n "_gofundme_donation_total" includes/class-admin-ui.php` returns line numbers
2. PHP syntax check: `php -l includes/class-admin-ui.php` returns no errors
  </verify>
  <done>
render_sync_meta_box() displays donation total, donor count, goal progress (when applicable), and last inbound sync timestamp below the existing sync status fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy to staging and verify display</name>
  <files>none (deployment only)</files>
  <action>
1. Deploy updated plugin to staging:
```bash
rsync -avz --exclude='.git' --exclude='.planning' --exclude='*.zip' \
  /Users/chadmacbook/projects/fcg/ \
  frederickc2stg@frederickc2stg.ssh.wpengine.net:~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/
```

2. Find a fund with existing donation data by querying staging:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post list --post_type=funds --meta_key=_gofundme_donation_total --meta_compare=EXISTS --fields=ID,post_title --format=csv | head -5"
```

3. If no funds have donation data yet, trigger inbound sync to populate:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp eval 'do_action(\"fcg_gfm_poll_inbound\");'"
```

4. Note the post ID for verification checkpoint in Plan 02.
  </action>
  <verify>
1. rsync completes without errors
2. WP-CLI query returns fund IDs (or inbound sync runs without errors)
  </verify>
  <done>
Plugin v2.3.0 deployed to staging. At least one fund has donation data for visual verification.
  </done>
</task>

</tasks>

<verification>
- [ ] class-admin-ui.php contains donation totals display code
- [ ] PHP syntax is valid
- [ ] Plugin deployed to staging without errors
- [ ] Staging has funds with donation data for verification
</verification>

<success_criteria>
1. Meta box displays donation total formatted as currency
2. Meta box displays donor count as integer
3. Meta box displays goal progress percentage when goal exists
4. Meta box displays last inbound sync timestamp
5. Empty states show "Never" or "$0.00" appropriately
</success_criteria>

<output>
After completion, create `.planning/phases/08-production-launch/08-01-SUMMARY.md`
</output>
