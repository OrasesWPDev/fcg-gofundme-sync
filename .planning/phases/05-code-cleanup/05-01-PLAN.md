---
phase: 05-code-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/class-sync-handler.php
  - includes/class-api-client.php
autonomous: true

must_haves:
  truths:
    - "Plugin activates without PHP fatal errors"
    - "Designation sync still works (create on publish, update on edit, deactivate on trash)"
    - "No campaign duplication occurs when funds are published"
    - "No campaign status changes occur when funds are trashed/restored"
  artifacts:
    - path: "includes/class-sync-handler.php"
      provides: "Designation-only sync handler"
      min_lines: 300
    - path: "includes/class-api-client.php"
      provides: "API client without campaign lifecycle methods"
      min_lines: 250
  key_links:
    - from: "includes/class-sync-handler.php"
      to: "includes/class-api-client.php"
      via: "designation API calls"
      pattern: "\\$this->api->(create|update|delete)_designation"
---

<objective>
Remove obsolete campaign sync code from sync-handler and API client

Purpose: Clean up dead code from architecture pivot - campaign duplication/status management is no longer used
Output: Sync handler and API client with only designation sync logic
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-code-cleanup/05-CONTEXT.md
@.planning/phases/05-code-cleanup/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove campaign methods and constants from sync-handler.php</name>
  <files>includes/class-sync-handler.php</files>
  <action>
Remove the following from FCG_GFM_Sync_Handler:

**Constants to remove (lines 31-39):**
- META_CAMPAIGN_ID
- META_CAMPAIGN_URL

**Methods to remove entirely:**
- sync_campaign_to_gofundme() (lines 579-595)
- create_campaign_in_gfm() (lines 479-552)
- update_campaign_in_gfm() (lines 561-571)
- build_campaign_data() (lines 426-446)
- get_campaign_id() (lines 603-606)
- get_campaign_url() (lines 614-617)
- should_sync_campaign() (lines 625-639)
- ensure_campaign_active() (lines 342-382)
- get_fund_goal() (lines 454-468) — only used by build_campaign_data()

**Code to remove from hook callbacks:**

In on_save_fund() (line 134):
- Remove: `$this->sync_campaign_to_gofundme($post_id, $post);`

In on_trash_fund() (lines 164-171):
- Remove the entire campaign deactivation block starting with `$campaign_id = $this->get_campaign_id($post_id);`

In on_untrash_fund() (lines 201-228):
- Remove the entire campaign reactivation block starting with `$campaign_id = $this->get_campaign_id($post_id);`

In on_delete_fund() (lines 256-263):
- Remove the entire campaign deactivation block starting with `$campaign_id = $this->get_campaign_id($post_id);`

In on_status_change() (lines 302-329):
- Remove the entire campaign status sync block starting with `$campaign_id = $this->get_campaign_id($post->ID);`

**Keep all designation sync code intact:**
- build_designation_data()
- create_designation()
- update_designation()
- get_designation_id()
- All hook registrations (save_post_funds, wp_trash_post, untrash_post, before_delete_post, transition_post_status)
  </action>
  <verify>
Run: `php -l includes/class-sync-handler.php`
Expect: No syntax errors

Run: `grep -n "campaign" includes/class-sync-handler.php`
Expect: No matches (all campaign references removed)

Run: `grep -n "designation" includes/class-sync-handler.php`
Expect: Multiple matches (designation code preserved)
  </verify>
  <done>
- META_CAMPAIGN_ID and META_CAMPAIGN_URL constants removed
- All 9 campaign methods removed
- Campaign code removed from all 5 hook callbacks
- Designation sync code unchanged
- File passes PHP syntax check
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove campaign lifecycle methods from api-client.php</name>
  <files>includes/class-api-client.php</files>
  <action>
Remove the following methods from FCG_GFM_API_Client:

**Methods to REMOVE (used by deleted sync-handler code):**
- duplicate_campaign() (lines 379-395)
- publish_campaign() (lines 397-408)
- unpublish_campaign() (lines 410-421)
- reactivate_campaign() (lines 423-434)
- deactivate_campaign() (lines 369-377)

**Methods to KEEP (used by inbound sync, admin UI, and Phase 6):**
- create_campaign() — may be useful for master campaign setup
- update_campaign() — USED by Phase 6 for linking designations to master campaign
- get_campaign() — USED by admin UI for validation
- get_campaign_overview() — USED by inbound sync for donation totals
- get_all_campaigns() — useful for debugging

**Methods to KEEP (core functionality):**
- All designation methods (create, update, delete, get, get_all)
- OAuth2 token methods
- Generic request() method
  </action>
  <verify>
Run: `php -l includes/class-api-client.php`
Expect: No syntax errors

Run: `grep -n "duplicate_campaign\|publish_campaign\|unpublish_campaign\|reactivate_campaign\|deactivate_campaign" includes/class-api-client.php`
Expect: No matches (lifecycle methods removed)

Run: `grep -n "get_campaign_overview\|update_campaign\|get_campaign" includes/class-api-client.php`
Expect: Matches found (useful methods preserved)
  </verify>
  <done>
- 5 campaign lifecycle methods removed (duplicate, publish, unpublish, reactivate, deactivate)
- 5 campaign methods preserved (create, update, get, get_overview, get_all)
- All designation methods intact
- File passes PHP syntax check
  </done>
</task>

</tasks>

<verification>
1. Both files pass PHP syntax check
2. No "campaign" references remain in sync-handler.php
3. API client retains campaign methods needed for Phase 6 and inbound sync
4. All designation methods preserved in both files
</verification>

<success_criteria>
- sync-handler.php contains only designation sync logic
- api-client.php contains designation methods + useful campaign methods (no lifecycle methods)
- Both files pass PHP lint check
- ~400 lines of dead code removed
</success_criteria>

<output>
After completion, create `.planning/phases/05-code-cleanup/05-01-SUMMARY.md`
</output>
