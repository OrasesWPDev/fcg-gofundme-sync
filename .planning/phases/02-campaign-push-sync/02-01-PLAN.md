---
phase: 02-campaign-push-sync
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/class-api-client.php
autonomous: true

must_haves:
  truths:
    - "API client can duplicate a campaign from template"
    - "API client can publish a campaign to make it active"
    - "API client can unpublish a campaign to draft status"
    - "API client can reactivate a deactivated campaign"
  artifacts:
    - path: "includes/class-api-client.php"
      provides: "Campaign lifecycle API methods"
      exports: ["duplicate_campaign", "publish_campaign", "unpublish_campaign", "reactivate_campaign"]
  key_links:
    - from: "FCG_GFM_API_Client::duplicate_campaign()"
      to: "/campaigns/{id}/actions/duplicate"
      via: "POST request"
      pattern: "actions/duplicate"
    - from: "FCG_GFM_API_Client::publish_campaign()"
      to: "/campaigns/{id}/actions/publish"
      via: "POST request"
      pattern: "actions/publish"
---

<objective>
Add campaign lifecycle API methods to FCG_GFM_API_Client.

Purpose: The sync handler needs methods to duplicate template campaigns, publish them after duplication, unpublish for draft status, and reactivate from deactivated state.

Output: Four new public methods in class-api-client.php that wrap Classy campaign action endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-campaign-push-sync/02-RESEARCH.md
@includes/class-api-client.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add campaign lifecycle methods to API client</name>
  <files>includes/class-api-client.php</files>
  <action>
Add four new public methods to FCG_GFM_API_Client class after the existing `deactivate_campaign()` method (around line 364):

1. `duplicate_campaign($source_campaign_id, array $overrides = []): array`
   - Makes POST request to `/campaigns/{source_campaign_id}/actions/duplicate`
   - Request body: `{"overrides": {...}, "duplicates": []}`
   - The `duplicates: []` tells API not to duplicate related objects (tickets, ecards)
   - Returns standard response array with `success`, `data`, `error`
   - On success, `data` contains new campaign object with `id`, `canonical_url`, `status`

2. `publish_campaign($campaign_id): array`
   - Makes POST request to `/campaigns/{campaign_id}/actions/publish`
   - Empty request body (pass empty array)
   - Makes campaign active and visible to donors
   - Returns standard response array

3. `unpublish_campaign($campaign_id): array`
   - Makes POST request to `/campaigns/{campaign_id}/actions/unpublish`
   - Empty request body
   - Returns campaign to unpublished (draft) status without deactivating
   - Returns standard response array

4. `reactivate_campaign($campaign_id): array`
   - Makes POST request to `/campaigns/{campaign_id}/actions/reactivate`
   - Empty request body
   - Returns deactivated campaign to unpublished status (requires publish afterward)
   - Returns standard response array

Follow existing method patterns in the file for PHPDoc, type hints, and return structure.
  </action>
  <verify>
Run syntax check: `php -l includes/class-api-client.php`
Verify methods exist: `grep -E "(duplicate_campaign|publish_campaign|unpublish_campaign|reactivate_campaign)" includes/class-api-client.php`
  </verify>
  <done>
Four new methods exist in FCG_GFM_API_Client:
- duplicate_campaign() posts to /campaigns/{id}/actions/duplicate
- publish_campaign() posts to /campaigns/{id}/actions/publish
- unpublish_campaign() posts to /campaigns/{id}/actions/unpublish
- reactivate_campaign() posts to /campaigns/{id}/actions/reactivate
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy and test API methods on staging</name>
  <files>includes/class-api-client.php</files>
  <action>
1. Deploy updated plugin to WP Engine staging:
   ```bash
   rsync -avz --exclude='.git' --exclude='.planning' \
     /Users/chadmacbook/projects/fcg/ \
     frederickc2stg@frederickc2stg.ssh.wpengine.net:~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/
   ```

2. SSH to staging and run a quick functional test using WP-CLI eval:
   ```bash
   ssh frederickc2stg@frederickc2stg.ssh.wpengine.net
   cd ~/sites/frederickc2stg

   # Test duplicate_campaign method exists and can be called
   wp eval '
   $api = new FCG_GFM_API_Client();
   if (method_exists($api, "duplicate_campaign")) {
     echo "duplicate_campaign: EXISTS\n";
   }
   if (method_exists($api, "publish_campaign")) {
     echo "publish_campaign: EXISTS\n";
   }
   if (method_exists($api, "unpublish_campaign")) {
     echo "unpublish_campaign: EXISTS\n";
   }
   if (method_exists($api, "reactivate_campaign")) {
     echo "reactivate_campaign: EXISTS\n";
   }
   '
   ```

3. Test actual duplication with template campaign 762968:
   ```bash
   wp eval '
   $api = new FCG_GFM_API_Client();
   $result = $api->duplicate_campaign(762968, [
     "name" => "API Test Campaign " . time(),
     "raw_goal" => "100.00",
     "raw_currency_code" => "USD"
   ]);
   if ($result["success"]) {
     $id = $result["data"]["id"];
     $url = $result["data"]["canonical_url"] ?? "no-url";
     echo "SUCCESS: Campaign {$id} created\n";
     echo "URL: {$url}\n";
     echo "Status: " . $result["data"]["status"] . "\n";

     // Clean up - deactivate test campaign
     $api->deactivate_campaign($id);
     echo "Test campaign deactivated\n";
   } else {
     echo "FAILED: " . $result["error"] . "\n";
   }
   '
   ```

If duplication succeeds, the API methods are working correctly.
  </action>
  <verify>
WP-CLI eval outputs "SUCCESS: Campaign {id} created" with a campaign ID and URL.
Status shows "unpublished" (confirming research that new campaigns start unpublished).
  </verify>
  <done>
API methods deployed to staging and functional test confirms:
- duplicate_campaign() successfully creates campaign from template
- Response includes id, canonical_url, and status
- New campaigns start in "unpublished" status (publish required separately)
  </done>
</task>

</tasks>

<verification>
1. `php -l includes/class-api-client.php` returns no errors
2. All four methods exist in the API client class
3. Staging deployment successful
4. WP-CLI test creates campaign via duplication from template 762968
</verification>

<success_criteria>
- Four new API methods added to FCG_GFM_API_Client
- Methods follow existing code patterns and PHPDoc style
- Duplication from template 762968 works on staging sandbox
- Test confirms new campaigns start in "unpublished" status
</success_criteria>

<output>
After completion, create `.planning/phases/02-campaign-push-sync/02-01-SUMMARY.md`
</output>
