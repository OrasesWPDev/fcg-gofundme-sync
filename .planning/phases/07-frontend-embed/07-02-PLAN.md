---
phase: 07-frontend-embed
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Fund single page displays Classy donation embed"
    - "Modal popup displays same Classy donation embed"
    - "Correct designation is pre-selected in embed"
    - "Fallback message appears for funds without designation"
  artifacts: []
  key_links:
    - from: "browser URL"
      to: "Classy SDK"
      via: "designation parameter"
      pattern: "\\?designation=\\d+"
---

<objective>
Deploy updated fund-form.php to WP Engine staging and verify Classy embed works on both single fund page and modal popup.

Purpose: Confirm the embed integration works end-to-end before production deployment.

Output: Verified working Classy embed with designation pre-selection on staging environment.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-embed/07-RESEARCH.md
@.planning/phases/07-frontend-embed/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy theme file to WP Engine staging</name>
  <files></files>
  <action>
Deploy the updated fund-form.php to WP Engine staging using rsync.

**Deploy command:**
```bash
rsync -avz "/Users/chadmacbook/Local Sites/frederick-county-gives/app/public/wp-content/themes/community-foundation/fund-form.php" \
  frederickc2stg@frederickc2stg.ssh.wpengine.net:~/sites/frederickc2stg/wp-content/themes/community-foundation/fund-form.php
```

Note: Only deploying the single modified theme file, not the entire theme directory.

If SSH times out, wait 2-3 minutes and retry. WP Engine occasionally has brief connection issues.
  </action>
  <verify>
Verify file exists on staging:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net "cat ~/sites/frederickc2stg/wp-content/themes/community-foundation/fund-form.php | head -20"
```

Confirm output shows the new Classy embed code (should see `classy=` and `get_option`).
  </verify>
  <done>
fund-form.php deployed to WP Engine staging, contains Classy embed code.
  </done>
</task>

<task type="auto">
  <name>Task 2: Find test fund URLs on staging</name>
  <files></files>
  <action>
Query WordPress to find a fund with a designation ID for testing.

Use WP-CLI on staging to find a published fund with designation:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net "cd ~/sites/frederickc2stg && wp post list --post_type=funds --post_status=publish --meta_key=_gofundme_designation_id --fields=ID,post_title,guid --format=table | head -10"
```

Also get the fund's URL and designation ID:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net "cd ~/sites/frederickc2stg && wp post meta get \$(wp post list --post_type=funds --post_status=publish --meta_key=_gofundme_designation_id --format=ids | head -1 | cut -d' ' -f1) _gofundme_designation_id"
```

Record:
- Fund post ID
- Fund title
- Fund URL (single page)
- Designation ID
  </action>
  <verify>
Output includes fund ID, title, and designation ID. Fund URL can be constructed as: `https://frederickc2stg.wpengine.com/funds/{fund-slug}/`
  </verify>
  <done>
Test fund identified with designation ID for verification testing.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Classy embedded donation form on fund pages, with designation pre-selection.

**Settings verified (Phase 6):**
- Master Campaign ID: 764694
- Master Component ID: mKAgOmLtRHVGFGh_eaqM6
- Classy WP Plugin: Installed and configured with Org ID 105659
  </what-built>
  <how-to-verify>
**Test 1: Single Fund Page**

1. Visit the test fund URL on staging (provided in Task 2 output)
   - Example: `https://frederickc2stg.wpengine.com/funds/{fund-slug}/`

2. Verify:
   - [ ] Classy donation form loads (not the old Acceptiva form)
   - [ ] Form shows donation amount options
   - [ ] URL in browser includes `?designation={id}` parameter
   - [ ] Correct fund appears pre-selected in designation dropdown (click "More Options" or similar to see fund list)

3. Check browser console (F12 > Console):
   - [ ] No JavaScript errors related to Classy SDK
   - [ ] No 404 errors for SDK loading

**Test 2: Modal Popup (Archive Page)**

1. Visit the funds archive page: `https://frederickc2stg.wpengine.com/funds/`

2. Find a fund card and click the "Give" or donate button to open the modal

3. Verify:
   - [ ] Classy donation form loads in modal
   - [ ] Correct fund is shown/pre-selected for that specific fund

**Test 3: Fallback (Optional)**

1. If you can find/create a fund WITHOUT a designation ID, visit its single page

2. Verify:
   - [ ] Fallback message appears: "Online donations for this fund are coming soon"
   - [ ] Contact link is present

**Expected Result:**
- Donation forms load via Classy SDK
- Correct fund pre-selected based on designation ID
- No legacy cart functionality visible
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 7 complete when:
- Classy embed loads on single fund page
- Classy embed loads in modal popup
- Designation pre-selection works (correct fund shown)
- No JavaScript console errors
- Legacy Acceptiva form no longer appears
</verification>

<success_criteria>
- Fund single page displays working Classy donation embed
- Modal popup displays same working embed with correct fund
- URL parameter injection adds `?designation={id}` for pre-selection
- Human verification confirms donation flow is functional
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-embed/07-02-SUMMARY.md`
</output>
