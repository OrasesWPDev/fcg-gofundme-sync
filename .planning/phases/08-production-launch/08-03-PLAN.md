---
phase: 08-production-launch
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - includes/class-admin-ui.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Funds with designation IDs show 'Synced' in list table"
    - "Synced status includes last sync timestamp in tooltip"
  artifacts:
    - path: "includes/class-admin-ui.php"
      provides: "Fixed sync status column logic"
      contains: "fcg-sync-synced"
  key_links:
    - from: "includes/class-admin-ui.php"
      to: "post_meta"
      via: "get_post_meta() for _gofundme_designation_id"
      pattern: "_gofundme_designation_id"
---

<objective>
Fix sync status column to show "Synced" for funds with designation IDs

Purpose: The current logic incorrectly shows "Pending" for funds that were synced more than 15 minutes ago. If a fund has a designation ID and no sync error, it should show "Synced" regardless of when it was last synced.

Output: Updated class-admin-ui.php with correct sync status logic.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Fix sync status column logic</name>
  <files>includes/class-admin-ui.php</files>
  <action>
In `render_sync_column()` method (around lines 94-105), replace the flawed 15-minute check with simple logic:

**Current (wrong):**
```php
if ($last_sync) {
    $last_sync_time = strtotime($last_sync);
    $fifteen_min_ago = time() - (15 * 60);

    if ($last_sync_time > $fifteen_min_ago) {
        echo '<span class="fcg-sync-status fcg-sync-synced" title="Last synced: ' . esc_attr($last_sync) . '">Synced</span>';
    } else {
        echo '<span class="fcg-sync-status fcg-sync-pending" title="Last synced: ' . esc_attr($last_sync) . '">Pending</span>';
    }
} else {
    echo '<span class="fcg-sync-status fcg-sync-pending" title="Never synced">Pending</span>';
}
```

**New (correct):**
```php
// Has designation ID and no error = Synced
if ($last_sync) {
    echo '<span class="fcg-sync-status fcg-sync-synced" title="Last synced: ' . esc_attr($last_sync) . '">Synced</span>';
} else {
    // Has designation but no last_sync timestamp (edge case - manual entry)
    echo '<span class="fcg-sync-status fcg-sync-synced" title="Designation linked">Synced</span>';
}
```

The logic is now:
- No designation_id → "Not Linked"
- Has sync_error → "Error"
- Has designation_id → "Synced" (with last sync time in tooltip)
  </action>
  <verify>
1. `grep -n "fifteen_min_ago" includes/class-admin-ui.php` returns no lines (removed)
2. PHP syntax check: `php -l includes/class-admin-ui.php` returns no errors
  </verify>
  <done>
Sync status column correctly shows "Synced" for all funds with designation IDs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy to staging and verify</name>
  <files>none (deployment only)</files>
  <action>
1. Deploy updated plugin to staging:
```bash
rsync -avz --exclude='.git' --exclude='.planning' --exclude='*.zip' \
  /Users/chadmacbook/projects/fcg/ \
  frederickc2stg@frederickc2stg.ssh.wpengine.net:~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/
```

2. Verify in staging admin that funds list shows "Synced" instead of "Pending"
  </action>
  <verify>
1. rsync completes without errors
  </verify>
  <done>
Plugin deployed to staging. Funds list now shows correct sync status.
  </done>
</task>

</tasks>

<verification>
- [ ] 15-minute check removed from sync status logic
- [ ] PHP syntax is valid
- [ ] Plugin deployed to staging
- [ ] Funds with designation IDs show "Synced" in list table
</verification>

<success_criteria>
1. All synced funds show "Synced" status in list table
2. Tooltip shows last sync timestamp
3. "Not Linked" still shown for funds without designation ID
4. "Error" still shown for funds with sync errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-production-launch/08-03-SUMMARY.md`
</output>
