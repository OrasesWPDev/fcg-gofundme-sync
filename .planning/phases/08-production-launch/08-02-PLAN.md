---
phase: 08-production-launch
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - docs/production-deployment-checklist.md
autonomous: false

must_haves:
  truths:
    - "Deleting a fund permanently removes its designation from Classy"
    - "DELETE removes designation from both campaign group AND org designations"
    - "Admin can see donation totals in fund edit screen"
  artifacts:
    - path: "docs/production-deployment-checklist.md"
      provides: "Complete production deployment guide"
      contains: "DELETE verification"
  key_links:
    - from: "includes/class-sync-handler.php"
      to: "includes/class-api-client.php"
      via: "delete_designation() call in on_delete_fund()"
      pattern: "api->delete_designation"
---

<objective>
Verify DELETE sync functionality and finalize production deployment checklist

Purpose: Confirm that permanently deleting a fund removes its designation from Classy entirely (not just deactivates), and ensure the deployment checklist covers all steps. This is the final MVP validation before production go-live.

Output: Verified DELETE behavior + Updated deployment checklist with verification evidence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-production-launch/08-RESEARCH.md
@.planning/phases/08-production-launch/08-01-SUMMARY.md

# Source files
@includes/class-sync-handler.php
@includes/class-api-client.php
@docs/production-deployment-checklist.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test fund for DELETE verification</name>
  <files>none (staging test)</files>
  <action>
1. Create a test fund on staging via WP-CLI:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post create --post_type=funds --post_title='DELETE Test - Phase 8 Verification' --post_status=publish --porcelain"
```

2. Note the returned post ID.

3. Verify designation was created in Classy:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post meta get {POST_ID} _gofundme_designation_id"
```

4. Record the designation ID for verification.

5. Verify designation exists in Classy via API (optional, for thoroughness):
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp eval '\$api = new FCG_GFM_API_Client(); \$r = \$api->get_designation({DESIGNATION_ID}); print_r(\$r);'"
```
  </action>
  <verify>
1. wp post create returns a post ID
2. _gofundme_designation_id meta exists and has a value
3. API returns designation data (if checked)
  </verify>
  <done>
Test fund created on staging with designation ID recorded.
  </done>
</task>

<task type="auto">
  <name>Task 2: Test trash behavior (deactivate, not delete)</name>
  <files>none (staging test)</files>
  <action>
1. Trash the test fund (should deactivate, NOT delete):
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post update {POST_ID} --post_status=trash"
```

2. Verify designation still exists but is inactive:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp eval '\$api = new FCG_GFM_API_Client(); \$r = \$api->get_designation({DESIGNATION_ID}); echo \"is_active: \" . (\$r[\"data\"][\"is_active\"] ? \"true\" : \"false\") . \"\\n\";'"
```

Expected: `is_active: false`

3. Restore from trash to re-activate:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post update {POST_ID} --post_status=publish"
```

4. Verify designation is active again:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp eval '\$api = new FCG_GFM_API_Client(); \$r = \$api->get_designation({DESIGNATION_ID}); echo \"is_active: \" . (\$r[\"data\"][\"is_active\"] ? \"true\" : \"false\") . \"\\n\";'"
```

Expected: `is_active: true`
  </action>
  <verify>
1. After trash: designation exists with is_active: false
2. After restore: designation exists with is_active: true
  </verify>
  <done>
Trash/restore cycle verified: trashing deactivates designation, restoring reactivates it.
  </done>
</task>

<task type="auto">
  <name>Task 3: Test permanent delete (removes from Classy)</name>
  <files>none (staging test)</files>
  <action>
1. Re-trash the test fund:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post update {POST_ID} --post_status=trash"
```

2. Permanently delete the fund:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp post delete {POST_ID} --force"
```

3. Verify designation is GONE from Classy:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "cd ~/sites/frederickc2stg && wp eval '\$api = new FCG_GFM_API_Client(); \$r = \$api->get_designation({DESIGNATION_ID}); echo \"success: \" . (\$r[\"success\"] ? \"true\" : \"false\") . \"\\n\"; if (!empty(\$r[\"error\"])) echo \"error: \" . \$r[\"error\"] . \"\\n\";'"
```

Expected: `success: false` with 404 error (designation not found)

4. Check PHP error log for confirmation:
```bash
ssh frederickc2stg@frederickc2stg.ssh.wpengine.net \
  "grep 'Deleted designation' ~/sites/frederickc2stg/wp-content/debug.log 2>/dev/null | tail -3 || echo 'No debug log or no entries'"
```

Classy call 2026-01-29 confirmed: DELETE removes designation from both campaign's Default Active Group AND the organization's designations list entirely.
  </action>
  <verify>
1. wp post delete returns success
2. API get_designation returns 404 (not found)
3. Debug log shows "Deleted designation {ID} for deleted post {ID}"
  </verify>
  <done>
DELETE sync verified: permanently deleting a fund removes its designation from Classy entirely.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
1. Admin meta box with donation totals (from Plan 08-01)
2. DELETE sync verification (trash deactivates, permanent delete removes)
  </what-built>
  <how-to-verify>
**Admin UI Verification:**
1. Go to staging WP admin: https://frederickc2stg.wpengine.com/wp-admin/
2. Navigate to Funds > Edit any fund with donations
3. Look at "GoFundMe Pro Sync" meta box in sidebar
4. Confirm you see:
   - Designation ID (clickable link)
   - Last Sync timestamp
   - Donation Total (formatted as currency)
   - Donor Count
   - Goal Progress (if goal set)
   - Last Inbound Sync timestamp

**DELETE Verification (already done via CLI):**
- Confirm the test fund is gone from WordPress
- Confirm the designation is gone from Classy (check Classy admin if desired)
  </how-to-verify>
  <resume-signal>Type "verified" if admin UI shows donation totals and DELETE behavior is confirmed, or describe any issues.</resume-signal>
</task>

<task type="auto">
  <name>Task 5: Update deployment checklist with verification evidence</name>
  <files>docs/production-deployment-checklist.md</files>
  <action>
1. Add DELETE verification section to Pre-Deployment Checklist:
```markdown
### Staging Verification (before production)
- [x] All 860+ funds have designation IDs synced
- [x] Test donation completes with correct designation
- [x] DELETE test: deleting a fund removes designation from Classy
  - Verified: 2026-01-XX via Phase 8 testing
  - Behavior: Trash = deactivate, Permanent delete = remove entirely
- [x] Inbound sync polling works (donation totals update)
- [x] Admin UI shows designation info correctly
  - Includes donation totals from inbound sync
```

2. Add ADMN-02 verification note:
```markdown
## Admin UI Features (Phase 8)

The fund edit screen meta box displays:
- Designation ID (with link to Classy admin)
- Last Sync timestamp
- Sync source
- Fundraising Goal (editable)
- **Donation Total** (from inbound sync)
- **Donor Count** (from inbound sync)
- **Goal Progress** (when goal set)
- **Last Inbound Sync** timestamp
- Sync Now button
```

3. Ensure the post-deployment verification includes admin UI check.
  </action>
  <verify>
1. `grep -n "DELETE test" docs/production-deployment-checklist.md` returns lines
2. `grep -n "Donation Total" docs/production-deployment-checklist.md` returns lines
  </verify>
  <done>
Deployment checklist updated with DELETE verification evidence and ADMN-02 documentation.
  </done>
</task>

</tasks>

<verification>
- [ ] Test fund created on staging with designation
- [ ] Trash deactivates designation (is_active: false)
- [ ] Restore reactivates designation (is_active: true)
- [ ] Permanent delete removes designation from Classy (404)
- [ ] Human verified admin UI shows donation totals
- [ ] Deployment checklist updated with verification evidence
</verification>

<success_criteria>
1. DELETE endpoint confirmed working: permanent delete removes designation from Classy entirely
2. Trash/restore cycle confirmed: deactivates and reactivates correctly
3. Admin UI displays donation totals (human verified)
4. Deployment checklist is complete and ready for production go-live
</success_criteria>

<output>
After completion, create `.planning/phases/08-production-launch/08-02-SUMMARY.md`
</output>
