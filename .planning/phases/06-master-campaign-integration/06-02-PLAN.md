---
phase: 06-master-campaign-integration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Plugin activates without errors on staging"
    - "Settings page displays master campaign and component ID fields"
    - "Creating a test fund results in designation appearing in master campaign dropdown"
    - "Existing designation sync still works"
  artifacts:
    - path: "staging deployment"
      provides: "Working plugin on WP Engine staging"
  key_links:
    - from: "WordPress save_post hook"
      to: "Classy API update_campaign"
      via: "sync-handler designation linking"
      pattern: "designation appears in Classy campaign dropdown"
---

<objective>
Deploy to staging and verify master campaign integration

Purpose: Confirm the new designation linking works end-to-end on real environment
Output: Verified working integration with new designation appearing in master campaign
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-master-campaign-integration/06-01-SUMMARY.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy plugin to WP Engine staging</name>
  <files></files>
  <action>
Deploy the updated plugin to WP Engine staging environment using rsync.

**Deployment command:**
```bash
rsync -avz --exclude='.git' --exclude='.planning' --exclude='*.zip' --exclude='.idea' --exclude='scripts' \
  /Users/chadmacbook/projects/fcg/ \
  frederickc2stg@frederickc2stg.ssh.wpengine.net:~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/
```

**Post-deployment verification:**
1. SSH into staging: `ssh frederickc2stg@frederickc2stg.ssh.wpengine.net`
2. Navigate to plugin: `cd ~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync`
3. Verify files updated:
   - `grep -n "master_campaign_id" includes/class-admin-ui.php` (should have matches)
   - `grep -n "link_designation_to_campaign" includes/class-sync-handler.php` (should have matches)
4. Check PHP syntax: `php -l includes/class-admin-ui.php includes/class-sync-handler.php`
  </action>
  <verify>
SSH to staging and run:
- `php -l ~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/includes/*.php`
- `php -l ~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/fcg-gofundme-sync.php`
All files should pass syntax check.

Check deployment timestamp:
- `ls -la ~/sites/frederickc2stg/wp-content/plugins/fcg-gofundme-sync/includes/`
Files should show recent modification time.
  </verify>
  <done>
- Plugin deployed to staging via rsync
- All PHP files pass syntax check on server
- Files show recent modification timestamps
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure master campaign settings in WordPress admin</name>
  <files></files>
  <action>
Configure the master campaign settings on staging.

**Steps:**
1. Log into WordPress admin at staging URL
2. Navigate to Funds > Sync Settings
3. Verify the settings page now shows:
   - "Master Campaign ID" field (renamed from Template Campaign ID)
   - "Master Component ID" field (new)
4. Enter the master campaign values:
   - Master Campaign ID: 764694
   - Master Component ID: mKAgOmLtRHVGFGh_eaqM6
5. Save settings
6. Verify validation succeeds (green checkmark, campaign name displayed)

**Note:** If existing template setting was present, verify migration happened automatically.
Check debug log for: "[FCG GoFundMe Sync] Migrated template campaign setting to master campaign setting"
  </action>
  <verify>
In WordPress admin:
1. Navigate to Funds > Sync Settings
2. Confirm "Master Campaign ID" shows 764694
3. Confirm "Master Component ID" shows mKAgOmLtRHVGFGh_eaqM6
4. Confirm validation status shows green checkmark with campaign name

Via WP-CLI (SSH):
```bash
cd ~/sites/frederickc2stg && wp option get fcg_gofundme_master_campaign_id
cd ~/sites/frederickc2stg && wp option get fcg_gofundme_master_component_id
```
Should return 764694 and mKAgOmLtRHVGFGh_eaqM6 respectively.
  </verify>
  <done>
- Master Campaign ID configured as 764694
- Master Component ID configured as mKAgOmLtRHVGFGh_eaqM6
- Settings validated and saved
- Campaign name displays in admin UI
  </done>
</task>

<task type="auto">
  <name>Task 3: Create test fund and verify designation appears in master campaign</name>
  <files></files>
  <action>
Create a test fund to verify the complete designation sync and campaign linking flow.

**Steps:**
1. In WordPress admin, navigate to Funds > Add New
2. Create a test fund:
   - Title: "Phase 6 Test Fund - DELETE ME"
   - Content: "Test fund for verifying Phase 6 master campaign integration"
   - Status: Publish
3. Save/Publish the fund
4. Check the sync status in the GoFundMe Pro Sync meta box - should show "Synced" with designation ID

**Verify in Classy UI:**
1. Log into Classy admin
2. Navigate to master campaign (764694)
3. Go to campaign's designation settings / Group Designations
4. Verify "Phase 6 Test Fund - DELETE ME" appears in the Default Active Group

**Check debug log on staging:**
```bash
tail -100 ~/sites/frederickc2stg/wp-content/debug.log | grep -i "gofundme"
```
Should see:
- "Created designation {id} for post {id}"
- "Linked designation {id} to master campaign 764694 for post {id}"

**Important:** Do NOT delete the test fund yet - it will be used for checkpoint verification.
  </action>
  <verify>
1. Test fund created and published in WordPress
2. Designation ID shown in meta box (note the ID)
3. Debug log shows successful creation AND linking messages
4. Classy UI shows designation in master campaign's active group
  </verify>
  <done>
- Test fund created with title "Phase 6 Test Fund - DELETE ME"
- Designation ID assigned and stored in meta
- Debug log confirms designation creation AND campaign linking
- Classy UI shows designation in master campaign dropdown
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Master campaign integration - settings update and automatic designation linking

After Phase 6 Plan 01 implementation and deployment:
1. Settings page renamed "Template Campaign ID" to "Master Campaign ID"
2. Added new "Master Component ID" setting
3. Sync handler now links new designations to master campaign after creation
4. Test fund created to verify end-to-end flow
  </what-built>
  <how-to-verify>
**WordPress Admin Verification:**
1. Go to Funds > Sync Settings
2. Confirm "Master Campaign ID" shows 764694 with green checkmark
3. Confirm "Master Component ID" shows mKAgOmLtRHVGFGh_eaqM6
4. Go to Funds > All Funds, find "Phase 6 Test Fund - DELETE ME"
5. Edit the fund, check GoFundMe Pro Sync meta box shows designation ID

**Classy Admin Verification (CRITICAL):**
1. Log into Classy admin at https://www.classy.org/admin
2. Navigate to campaign 764694 (master campaign)
3. Go to Edit Campaign > Settings > Designations (or similar path to Group Designations)
4. Find "Default Active Group" or "Group designations"
5. **VERIFY:** "Phase 6 Test Fund - DELETE ME" appears in the list

If the test designation appears in Classy's campaign dropdown, the integration is working.

**Cleanup after verification:**
- Trash the test fund in WordPress (will deactivate designation)
- Optionally delete designation from Classy if you want to remove it completely
  </how-to-verify>
  <resume-signal>
Type "approved" if the test designation appears in the master campaign's active designation group in Classy.

If issues found, describe what you see:
- "Settings not showing" - settings page issue
- "Designation not in Classy dropdown" - linking issue
- "Error in meta box" - creation issue
  </resume-signal>
</task>

</tasks>

<verification>
1. Plugin deployed and running on staging
2. Settings configured with master campaign ID and component ID
3. Test fund creates designation AND links it to master campaign
4. Designation visible in Classy campaign dropdown
5. User confirms end-to-end integration working
</verification>

<success_criteria>
- Plugin deployed to staging without errors
- Settings page shows Master Campaign ID (764694) and Master Component ID
- Test fund designation appears in master campaign's active designation group in Classy
- Debug log confirms both creation and linking succeeded
- User approves checkpoint verification
</success_criteria>

<output>
After completion, create `.planning/phases/06-master-campaign-integration/06-02-SUMMARY.md`
</output>
